specVersion: 0.0.1
description: Graph for Staking contract of the Yield Farming and DAO
repository: https://github.com/fiatdao/fiat-subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: PRBProxyFactory
    network: {{network}}
    source:
      address: '{{PRBProxyFactory}}'
      abi: PRBProxyFactory
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - UserProxy
      abis:
        - name: PRBProxyFactory
          file: ./abis/PRBProxyFactory.json
      eventHandlers:
        - event: DeployProxy(indexed address,indexed address,indexed address,bytes32,bytes32,address)
          handler: handleDeployProxy
      file: ./src/mappings.ts
  - kind: ethereum/contract
    name: Codex
    network: {{network}}
    source:
      address: '{{Codex}}'
      abi: Codex
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - Position
        - PositionTransaction
        - Collateral
        - FiatData
      abis:
        - name: Codex
          file: ./abis/Codex.json
        - name: Collybus
          file: ./abis/Collybus.json
        - name: IVault
          file: ./abis/IVault.json
        - name: Fiat
          file: ./abis/Fiat.json
        - name: VaultEPT
          file: ./abis/VaultEPT.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: ModifyCollateralAndDebt(indexed address,indexed uint256,indexed address,address,address,int256,int256)
          handler: handleModifyCollateralAndDebt
        - event: TransferCollateralAndDebt(indexed address,indexed uint256,indexed address,address,int256,int256)
          handler: handleTransferCollateralAndDebt
        - event: ConfiscateCollateralAndDebt(indexed address,indexed uint256,indexed address,address,address,int256,int256)
          handler: handleConfiscateCollateralAndDebt
        - event: Init(indexed address)
          handler: handleVaultInit
      file: ./src/mappings.ts
  {{#Notional}}
  - kind: ethereum/contract
    name: Notional
    network: {{network}}
    source:
      address: '{{Notional}}'
      abi: Notional
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - Vault
        - Collateral
      abis:
        - name: Notional
          file: ./abis/Notional.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: Collybus
          file: ./abis/Collybus.json
        - name: IVault
          file: ./abis/IVault.json
      eventHandlers:
        - event: MarketsInitialized(uint16)
          handler: handleMarketsInitialized
      file: ./src/mappings.ts
  {{/Notional}}
  - kind: ethereum/contract
    name: Fiat
    network: {{network}}
    source:
      address: '{{Fiat}}'
      abi: Fiat
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - FiatData
      abis:
        - name: Fiat
          file: ./abis/Fiat.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleFiatTransfer
      file: ./src/mappings.ts
  - kind: ethereum/contract
    name: Collybus
    network: {{network}}
    source:
      address: '{{Collybus}}'
      abi: Collybus
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - Collybus
        - Vault
      abis:
        - name: Collybus
          file: ./abis/Collybus.json
      eventHandlers:
        - event: SetParam(indexed address,indexed bytes32,uint256)
          handler: handleSetParam
      file: ./src/mappings.ts
  - kind: ethereum/contract
    name: CollateralAuction
    network: {{network}}
    source:
      address: '{{CollateralAuction}}'
      abi: CollateralAuction
      startBlock: {{startBlock}}
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.4
      language: wasm/assemblyscript
      entities:
        - CollateralAuction
        - Vault
        - Collateral
        - UserProxy
      abis:
        - name: CollateralAuction
          file: ./abis/CollateralAuction.json
      eventHandlers:
        - event: StartAuction(indexed uint256,uint256,uint256,uint256,address,uint256,address,indexed address,uint256)
          handler: handleStartAuction
        - event: TakeCollateral(indexed uint256,uint256,uint256,uint256,uint256,uint256,address,uint256,indexed address)
          handler: handleTakeCollateral
        - event: StopAuction(uint256)
          handler: handleStopAuction
      file: ./src/mappings.ts
