type UserProxy @entity {
  id: ID!
  proxyAddress: Bytes!
  userAddress: Bytes!
}

enum PositionTransactionType {
  MODIFY
  TRANSFER
  CONFISCATE
}

type PositionTransaction @entity {
  id: ID!
  type: String!
  collateral: BigInt!
  deltaCollateral: BigInt!
  normalDebt: BigInt!
  deltaNormalDebt: BigInt!
  position: Position!
}

type Position @entity {
  id: ID!
  vault: Vault!
  tokenId: Collateral!
  user: UserPosition!
  collateral: BigInt!
  normalDebt: BigInt!
  maturity: BigInt
  healthFactor: BigInt
  isAtRisk: Boolean
  positionTransactions: [PositionTransaction!] @derivedFrom(field: "position")
}

enum VaultType {
  ELEMENT,
  BARNBRIDGE,
  NOTIONAL
}

type Vault @entity {
  id: ID!
  address: Bytes
  name: String
  type: VaultType
  positions: [Position!] @derivedFrom(field: "vault")
  collaterals: [Collateral!] @derivedFrom(field: "vault")
}

type Collateral @entity {
  id: ID!
  address: Bytes
  name: String
  type: String
  maturity: BigInt
  underlierName: String
  underlierAddress: Bytes
  vault: Vault
  faceValue: BigInt
  currentValue: BigInt
  collaterizationRatio: BigInt
}

type UserPosition @entity {
  id: ID!
  # User Proxy Address
  userAddress: Bytes
  totalCollateral: BigInt
  totalFIAT: BigInt
  nearestMaturity: BigInt
  lowestHealthFactor: BigInt
  positions: [Position!] @derivedFrom(field: "user")
}

type FiatData @entity {
  id: ID!
  address: Bytes
  minted: BigInt
  burned: BigInt
  circulatingSupply: BigInt
  depositedCollateral: BigInt
  totalSupply: BigInt
}
